fragment MetadataFragment on Metadata {
  name
  namespace
  labels {
    name
    value
  }
  annotations {
    name
    value
  }
}

fragment NodeFragment on Node {
  metadata {
    ...MetadataFragment
  }
  status {
    phase
    allocatable
    capacity
    conditions {
      type
      status
      message
    }
  }
  spec {
    podCidr
    providerId
  }
}

fragment NodeMetricFragment on NodeMetric {
  metadata {
    ...MetadataFragment
  }
  usage {
    cpu
    memory
  }
  timestamp
  window
}

fragment ApiDeprecation on ApiDeprecation {
  availableIn
  blocking
  component {
    group
    kind
    name
    service {
      git {
        ref
        folder
      }
      repository {
        httpsPath
        urlFormat
      }
    }
  }
  deprecatedIn
  removedIn
  replacement
}

fragment ClustersRow on Cluster {
  apiDeprecations {
    ...ApiDeprecation
  }
  currentVersion
  id
  name
  nodes {
    status {
      capacity
    }
  }
  nodeMetrics {
    usage {
      cpu
      memory
    }
  }
  pingedAt
  provider {
    id
    cloud
    name
    namespace
  }
  self
  service {
    repository {
      url
    }
  }
  version
}

fragment Cluster on Cluster {
  apiDeprecations {
    ...ApiDeprecation
  }
  currentVersion
  id
  name
  nodes {
    ...NodeFragment
  }
  nodeMetrics {
    ...NodeMetricFragment
  }
  pingedAt
  provider {
    id
    cloud
    name
    namespace
  }
  self
  service {
    repository {
      url
    }
  }
  version
}

query Clusters {
  clusters(first: 100) {
    pageInfo {
      ...PageInfo
    }
    edges {
      node {
        ...ClustersRow
      }
    }
  }
}

query ClustersTiny {
  clusters(first: 100) {
    edges {
      node {
        id
        name
      }
    }
  }
}

query Cluster($id: ID!) {
  cluster(id: $id) {
    ...Cluster
  }
}

mutation UpdateCluster($id: ID!, $attributes: ClusterUpdateAttributes!) {
  updateCluster(id: $id, attributes: $attributes) {
    ...ClustersRow
  }
}
