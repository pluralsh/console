fragment AgentRunTiny on AgentRun {
  id
  status
  mode
  prompt
  shared
  error
  runtime {
    id
    name
    type
  }
  repository
  branch
  pullRequests {
    ...PullRequestBasic
  }
  podReference {
    name
    namespace
  }
}

fragment AgentRun on AgentRun {
  ...AgentRunTiny
  messages {
    ...AgentMessage
  }
  todos {
    ...AgentTodo
  }
  analysis {
    ...AgentAnalysis
  }
}

fragment AgentRuntime on AgentRuntime {
  id
  name
  type
  aiProxy
  cluster {
    ...ClusterTiny
  }
  default
  createBindings {
    ...PolicyBinding
  }
}

fragment AgentRunRepository on AgentRunRepository {
  id
  url
  lastUsedAt
}

fragment AgentAnalysis on AgentAnalysis {
  summary
  analysis
  bullets
}

fragment AgentTodo on AgentTodo {
  title
  description
  done
}

fragment AgentMessage on AgentMessage {
  id
  seq
  role
  message
  cost {
    ...AgentMessageCost
  }
  metadata {
    ...AgentMessageMetadata
  }
}

fragment AgentMessageMetadata on AgentMessageMetadata {
  reasoning {
    text
    start
    end
  }
  file {
    name
    text
    start
    end
  }
  tool {
    name
    state
    input
    output
  }
}

fragment AgentMessageCost on AgentMessageCost {
  total
  tokens {
    input
    output
    reasoning
  }
}

fragment AgentMessageDelta on AgentMessageDelta {
  delta
  payload {
    ...AgentMessage
  }
}

fragment ClusterUpgradeStep on ClusterUpgradeStep {
  id
  name
  prompt
  status
  type
  error
  agentRun {
    ...AgentRunTiny
  }
}

fragment ClusterUpgrade on ClusterUpgrade {
  id
  status
  steps {
    ...ClusterUpgradeStep
  }
  cluster {
    ...ClusterMinimal
  }
  runtime {
    type
    name
  }
  version
}

query AgentRuns($after: String, $first: Int = 100, $runtimeId: ID) {
  agentRuns(after: $after, first: $first, runtimeId: $runtimeId) {
    pageInfo {
      ...PageInfo
    }
    edges {
      node {
        ...AgentRunTiny
      }
    }
  }
}

query AgentRunTiny($id: ID!) {
  agentRun(id: $id) {
    ...AgentRunTiny
  }
}

query AgentRun($id: ID!) {
  agentRun(id: $id) {
    ...AgentRun
  }
}

query AgentRunPod($id: ID!) {
  agentRun(id: $id) {
    id
    prompt
    pod {
      ...Pod
    }
  }
}

query AgentRuntimes($after: String, $first: Int = 100) {
  agentRuntimes(after: $after, first: $first) {
    pageInfo {
      ...PageInfo
    }
    edges {
      node {
        ...AgentRuntime
      }
    }
  }
}

query AgentRuntime($id: ID!) {
  agentRuntime(id: $id) {
    ...AgentRuntime
  }
}

query AgentRunPodLogs($runId: ID!, $container: String!, $sinceSeconds: Int!) {
  agentRun(id: $runId) {
    pod {
      logs(container: $container, sinceSeconds: $sinceSeconds)
    }
  }
}

query AgentRunRepositories($after: String, $first: Int = 100, $q: String) {
  agentRunRepositories(after: $after, first: $first, q: $q) {
    pageInfo {
      ...PageInfo
    }
    edges {
      node {
        ...AgentRunRepository
      }
    }
  }
}

mutation CreateAgentRun($runtimeId: ID!, $attributes: AgentRunAttributes!) {
  createAgentRun(runtimeId: $runtimeId, attributes: $attributes) {
    ...AgentRun
  }
}

mutation CancelAgentRun($id: ID!) {
  cancelAgentRun(id: $id) {
    ...AgentRunTiny
  }
}

mutation UpsertAgentRuntime($attributes: AgentRuntimeAttributes!) {
  upsertAgentRuntime(attributes: $attributes) {
    ...AgentRuntime
  }
}

mutation ShareAgentRun($id: ID!, $shared: Boolean!) {
  shareAgentRun(id: $id, shared: $shared) {
    ...AgentRunTiny
  }
}

mutation CreateClusterUpgrade(
  $id: ID!
  $attributes: ClusterUpgradeAttributes!
) {
  createClusterUpgrade(id: $id, attributes: $attributes) {
    ...ClusterUpgrade
  }
}

subscription AgentRunChat($runId: ID!) {
  agentMessageDelta(runId: $runId) {
    delta
    payload {
      ...AgentMessage
    }
  }
}

subscription AgentRunDelta($runId: ID!) {
  agentRunDelta(id: $runId) {
    delta
    payload {
      ...AgentRunTiny
      todos {
        title
        description
        done
      }
      analysis {
        ...AgentAnalysis
      }
      podReference {
        name
        namespace
      }
    }
  }
}
