# fragment PostgresDatabaseMeta on Metadata {
#   name
#   namespace
#   labels {
#     name
#     value
#   }
#   annotations {
#     name
#     value
#   }
# }

# fragment PostgresSettings on PostgresSettings {
#   version
# }

fragment ResourceSpec on ResourceSpec {
  cpu
  memory
}

fragment Resources on Resources {
  limits {
    ...ResourceSpec
  }
  requests {
    ...ResourceSpec
  }
}

# fragment PostgresqlSpec on PostgresqlSpec {
#   databases
#   numberOfInstances
#   pods {
#     ...Pod
#   }
#   postgresql {
#     ...PostgresSettings
#   }
#   resources {
#     ...Resources
#   }
#   teamId
#   users
# }

fragment PostgresqlStatus on PostgresqlStatus {
  clusterStatus
}

fragment DatabaseTableRow on Postgresql {
  instances {
    uid
  }
  metadata {
    name
    namespace
  }
  spec {
    numberOfInstances
    databases
    # pods {
    #   raw
    # }
    postgresql {
      version
    }
    resources {
      ...Resources
    }
    databases
  }
  status {
    clusterStatus
  }
}

mutation RestorePostgres(
  $clone: CloneAttributes
  $name: String!
  $namespace: String!
  $timestamp: DateTime!
) {
  restorePostgres(
    clone: $clone
    name: $name
    namespace: $namespace
    timestamp: $timestamp
  ) {
    status {
      ...PostgresqlStatus
    }
    # ...PostgresDB
  }
}

fragment NamespaceMeta on Namespace {
  metadata {
    ...MetadataFragment
  }
}

query PostgresDatabases {
  postgresDatabases {
    ...DatabaseTableRow
  }
  namespaces {
    ...NamespaceMeta
  }
  applications {
    name
    spec {
      descriptor {
        type
        icons
      }
    }
  }
}

query PostgresDatabase($name: String!, $namespace: String!) {
  postgresDatabase(name: $name, namespace: $namespace) {
    ...DatabaseTableRow
  }
}
