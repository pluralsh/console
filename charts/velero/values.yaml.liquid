# Common configuration:
# - schedule          - default schedule CRON.
# - ttl               - time to live for backups created by default schedule.
#
# AWS configuration:
# - provider          - Provider name, "aws".
# - bucket            - Amazon S3 bucket name.
# - region            - AWS region.
# - accessKeyId       - AWS access key ID.
# - secretAccessKey   - AWS secret access key.
#
# Azure configuration:
# - provider          - Provider name, "azure".
# - container         - Azure blob container name.
# - subscriptionId    - Azure subscription ID.
# - tenantId          - Azure tenant ID.
# - clientId          - Azure client ID.
# - clientSecret      - Azure client secret.
# - resourceGroup     - Azure resource group name.
# - storageAccount    - Azure storage account name.
#
# GCS configuration:
# - provider          - Provider name, "gcp".
# - bucket            - GCS bucket name.
# - serviceAccountKey - Google service account key.

{% if configuration.schedule %}
schedule: {{ configuration.schedule }}
{% endif %}
{% if configuration.ttl %}
ttl: {{ configuration.ttl }}
{% endif %}

velero:
  configuration:
    backupStorageLocation:
      - name: default
        provider: {{ configuration.provider }}
        {% if configuration.provider == "azure" -%}
        bucket: {{ configuration.container }}
        {% else -%}
        bucket: {{ configuration.bucket }}
        {% endif -%}
        config:
          {% if configuration.provider == "aws" -%}
          region: {{ configuration.region }}
          {% endif -%}
          {% if configuration.provider == "azure" -%}
          resourceGroup: {{ configuration.resourceGroup }}
          storageAccount: {{ configuration.storageAccount }}
          {% endif -%}
    volumeSnapshotLocation:
      - name: default
        provider: {{ configuration.provider }}
        credential:
          name: velero
          key: cloud
        {% if configuration.provider == "aws" -%}
        config:
          region: {{ configuration.region }}
        {% endif -%}
  credentials:
    secretContents:
      cloud: |
        {% if configuration.provider == "aws" -%}
        [default]
        aws_access_key_id={{ configuration.accessKeyId }}
        aws_secret_access_key={{ configuration.secretAccessKey }}
        {%- endif -%}
        {% if configuration.provider == "azure" -%}
        AZURE_SUBSCRIPTION_ID={{ configuration.subscriptionId }}
        AZURE_TENANT_ID={{ configuration.tenantId }}
        AZURE_CLIENT_ID={{ configuration.clientId }}
        AZURE_CLIENT_SECRET={{ configuration.clientSecret }}
        AZURE_RESOURCE_GROUP={{ configuration.resourceGroup }}
        {%- endif -%}
        {% if configuration.provider == "gcp" -%}
        {{ configuration.serviceAccountKey }}
        {%- endif -%}
