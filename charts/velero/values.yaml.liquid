# Required configuration:
# - provider  - Provider name. Supported values: aws, azure.
# - bucket    - Amazon S3 bucket/Azure blob container name.
#
# Required Azure configuration:
# - subscriptionId - Azure subscription ID.
# - tenantId - Azure tenant ID.
# - clientId - Azure client ID.
# - clientSecret - Azure client secret.
# - resourceGroup - Azure resource group name.
# - storageAccount - Azure storage account name.
#
# Required AWS configuration:
# - accessKeyId - AWS access key ID. Required for AWS.
# - secretAccessKey - AWS secret access key. Required for AWS.

velero:
  configuration:
    backupStorageLocation:
      - name: default
        provider: {{ configuration.provider }}
        bucket: {{ configuration.bucket }}
        config:
          resourceGroup: {{ configuration.resourceGroup }}
          storageAccount: {{ configuration.storageAccount }}
    volumeSnapshotLocation:
      - name: default
        provider: {{ configuration.provider }}
        credential:
          name: velero
          key: cloud
  credentials:
    secretContents:
      cloud: |
        {%- if configuration.provider == "aws" -%}
        [default]
        aws_access_key_id={{ configuration.accessKeyId }}
        aws_secret_access_key={{ configuration.secretAccessKey }}
        {%- endif -%}
        {%- if configuration.provider == "azure" -%}
        AZURE_SUBSCRIPTION_ID={{ configuration.subscriptionId }}
        AZURE_TENANT_ID={{ configuration.tenantId }}
        AZURE_CLIENT_ID={{ configuration.clientId }}
        AZURE_CLIENT_SECRET={{ configuration.clientSecret }}
        AZURE_RESOURCE_GROUP={{ configuration.resourceGroup }}
        {%- endif -%}
