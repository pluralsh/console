query GetAgentRuntime($id: ID!) {
    agentRuntime(id: $id) {
        ...AgentRuntimeFragment
    }
}

query GetAgentRuntimeByName($name: String!) {
    agentRuntime(name: $name) {
        ...AgentRuntimeFragment
    }
}

mutation UpsertAgentRuntime($attributes: AgentRuntimeAttributes!) {
    upsertAgentRuntime(attributes: $attributes) {
        ...AgentRuntimeFragment
    }
}

mutation DeleteAgentRuntime($id: ID!) {
    deleteAgentRuntime(id: $id) {
        id
    }
}

query ListAgentRuntimes($after: String, $first: Int, $before: String, $last: Int, $q: String, $type: AgentRuntimeType) {
    agentRuntimes(after: $after, first: $first, before: $before, last: $last, q: $q, type: $type) {
        edges {
            node {
                ...AgentRuntimeFragment
            }
        }
        pageInfo {
            ...PageInfoFragment
        }
    }
}

query GetAgentRun($id: ID!) {
    agentRun(id: $id) {
        ...AgentRunFragment
    }
}

query ListAgentRuns($after: String, $first: Int, $before: String, $last: Int) {
    agentRuns(after: $after, first: $first, before: $before, last: $last) {
        edges {
            node {
                ...AgentRunFragment
            }
        }
        pageInfo {
            ...PageInfoFragment
        }
    }
}

query ListAgentRuntimePendingRuns($id: ID!, $after: String, $first: Int, $before: String, $last: Int) {
    agentRuntime(id: $id) {
        pendingRuns(after: $after, first: $first, before: $before, last: $last) {
            edges {
                node {
                    ...AgentRunFragment
                }
            }
            pageInfo {
                ...PageInfoFragment
            }
        }
    }
}

query GetAgentRunTodos($id: ID!) {
    agentRun(id: $id) {
        todos {
            ...AgentTodoFragment
        }
    }
}

mutation CancelAgentRun($id: ID!) {
    cancelAgentRun(id: $id) {
        id
    }
}

mutation CreateAgentRun($runtimeId: ID!, $attributes: AgentRunAttributes!) {
    createAgentRun(runtimeId: $runtimeId, attributes: $attributes) {
        ...AgentRunFragment
    }
}

mutation UpdateAgentRun($id: ID!, $attributes: AgentRunStatusAttributes!) {
    updateAgentRun(id: $id, attributes: $attributes) {
        ...AgentRunFragment
    }
}

mutation UpdateAgentRunAnalysis($id: ID!, $attributes: AgentAnalysisAttributes!) {
    updateAgentRunAnalysis(id: $id, attributes: $attributes) {
        ...AgentRunBaseFragment
    }
}

mutation UpdateAgentRunTodos($id: ID!, $todos: [AgentTodoAttributes]) {
    updateAgentRunTodos(id: $id, todos: $todos) {
        ...AgentRunBaseFragment
    }
}

mutation CreateAgentPullRequest($runId: ID!, $attributes: AgentPullRequestAttributes!) {
    agentPullRequest(runId: $runId, attributes: $attributes) {
        ...PullRequestFragment
    }
}

mutation CreateAgentMessage($runId: ID!, $attributes: AgentMessageAttributes!) {
  createAgentMessage(runId: $runId, attributes: $attributes) {
    id
    message
  }
}

fragment AgentRuntimeFragment on AgentRuntime {
    id
    name
    type
    aiProxy
    cluster {
        ...TinyClusterFragment
    }
    createBindings {
        ...PolicyBindingFragment
    }
}


fragment AgentPodReferenceFragment on AgentPodReference {
    name
    namespace
}

fragment AgentAnalysisFragment on AgentAnalysis {
    summary
    analysis
    bullets
}

fragment AgentTodoFragment on AgentTodo {
    description
    done
    title
}

fragment ScmCredentialFragment on ScmCreds {
    token
    username
}

fragment PluralCredsFragment on PluralCreds {
    token
    url
}

fragment AgentRunBaseFragment on AgentRun {
  id
  prompt
  repository
  mode
  language
  languageVersion
  todos {
    ...AgentTodoFragment
  }
}

fragment AgentRunFragment on AgentRun {
    ...AgentRunBaseFragment
    status
    podReference {
        ...AgentPodReferenceFragment
    }
    error
    analysis {
        ...AgentAnalysisFragment
    }
    scmCreds {
        ...ScmCredentialFragment
    }
    pluralCreds {
        ...PluralCredsFragment
    }
    runtime {
        ...AgentRuntimeFragment
    }
    user {
        id
        name
        email
    }
    flow {
        id
        name
    }
    pullRequests {
        ...PullRequestFragment
    }
}