name: K8s versions update
on:
  schedule:
    - cron: '0 0 * * *'
  pull_request:
    branches:
      - "**" # TODO: Remove before merging.
jobs:
  latest-k8s-version:
    runs-on: ubuntu-latest
    permissions:
      contents: 'write'
      id-token: 'write'
      pull-requests: 'write'
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Get latest K8s version
        run: make find-k8s-version
      - name: Get current version
        id: version
        run: echo "VERSION=$(cat KUBE_VERSION)" >> "$GITHUB_OUTPUT"
      - name: Create pull request
        uses: peter-evans/create-pull-request@v5
        with:
          title: Update KUBE_VERSION to ${{ steps.version.outputs.VERSION }}
          commit-message: Update KUBE_VERSION
          branch: k8s-version-${{ steps.version.outputs.VERSION }}
          labels: chore
          base: master
  update-k8s-versions:
    runs-on: ubuntu-latest
    permissions:
      contents: 'write'
      id-token: 'write'
      pull-requests: 'write'
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Update versions
      run: make find-versions-aws
    - name: Get current date
      id: date
      run: echo "DATE=$(date +'%Y-%m-%d')" >> "$GITHUB_OUTPUT"
    - name: Create pull request
      uses: peter-evans/create-pull-request@v5
      with:
        title: Update K8s versions
        commit-message: Update K8s versions
        branch: k8s-versions-update-${{ steps.date.outputs.DATE }}
        labels: chore
        base: master
